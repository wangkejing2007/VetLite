<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetLite - 獸醫學入門</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="detective.css">
    <link rel="stylesheet" href="profile.css">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">
    <!-- Ionicons for Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <ion-icon name="paw" class="logo-icon"></ion-icon>
                <h1>VetLite</h1>
            </div>
            <div class="user-profile">
                <span class="level-badge">王可恩</span>
            </div>

        </header>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- VIEW: DASHBOARD -->
            <section id="view-dashboard" class="view active-view">
                <div class="welcome-banner">
                    <h2>今日獸醫探險</h2>
                    <p>準備好學習新知識了嗎？</p>
                </div>

                <!-- Daily Term Card -->
                <div class="card daily-term-card">
                    <div class="card-header">
                        <ion-icon name="bulb-outline"></ion-icon>
                        <h3>每日一詞</h3>
                    </div>
                    <div class="card-body" id="daily-term-content">
                        <!-- Content injected by JS -->
                        <div class="loading">載入中...</div>
                    </div>
                </div>

                <!-- Learning Map Preview -->
                <div class="section-title">
                    <h3>學習路徑</h3>
                </div>
                <div class="learning-path-scroll">
                    <div class="path-node completed">
                        <div class="node-icon"><ion-icon name="checkmark-circle"></ion-icon></div>
                        <span>入門</span>
                    </div>
                    <div class="path-line active"></div>
                    <div class="path-node completed" onclick="switchTab('anatomy')">
                        <div class="node-icon"><ion-icon name="checkmark-circle"></ion-icon></div>
                        <span>解剖學</span>
                    </div>
                    <div class="path-line active"></div>
                    <div class="path-node completed" onclick="switchTab('flashcards')">
                        <div class="node-icon"><ion-icon name="checkmark-circle"></ion-icon></div>
                        <span>生理學</span>
                    </div>
                    <div class="path-line active"></div>
                    <div class="path-node active" onclick="switchTab('detective')">
                        <div class="node-icon"><ion-icon name="medkit"></ion-icon></div>
                        <span>病理學</span>
                    </div>
                </div>
            </section>

            <!-- VIEW: FLASHCARDS -->
            <section id="view-flashcards" class="view">
                <div class="header-row">
                    <h2>知識卡片</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="btn-icon" id="btn-review-toggle" onclick="toggleReviewMode()" title="只讀錯題本">
                            <ion-icon name="book-outline"></ion-icon>
                        </button>
                        <span class="filter-badge">解剖學基礎</span>
                        <button class="btn-icon" onclick="openAddCardModal()" title="新增卡片">
                            <ion-icon name="add"></ion-icon>
                        </button>
                    </div>
                </div>

                <div class="flashcard-container">
                    <div class="flashcard" id="current-flashcard">
                        <div class="card-face card-front">
                            <div class="card-content">
                                <span class="card-hint">點擊翻牌</span>
                                <h3 id="card-question">...</h3>
                                <button id="card-audio-btn" class="audio-btn hidden" onclick="playAudio(event)">
                                    <ion-icon name="volume-high"></ion-icon> 播放音效
                                </button>
                            </div>
                        </div>
                        <div class="card-face card-back">
                            <div class="card-content">
                                <h3 id="card-answer">...</h3>
                                <p id="card-explanation">...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls-area" id="card-controls" style="display: none;">
                    <p>這題對你來說？</p>
                    <div class="button-group">
                        <button class="btn btn-easy" onclick="handleCardResult('easy')">太簡單</button>
                        <button class="btn btn-hard" onclick="handleCardResult('hard')">還不熟</button>
                        <button class="btn btn-next" onclick="nextCard()">下一張 <ion-icon
                                name="arrow-forward"></ion-icon></button>
                    </div>
                </div>

                <!-- Add Card Modal -->
                <div id="add-card-modal" class="modal hidden">
                    <div class="modal-content">
                        <span class="close-modal" onclick="closeAddCardModal()">&times;</span>
                        <div class="modal-header">
                            <h3>新增知識卡片</h3>
                        </div>
                        <div class="form-body">
                            <div class="form-group">
                                <label>題目 (Question)</label>
                                <textarea id="new-card-q" placeholder="例如：貓的正常體溫範圍？" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label>答案 (Answer)</label>
                                <input type="text" id="new-card-a" placeholder="例如：38.0 - 39.2°C">
                            </div>
                            <div class="form-group">
                                <label>詳解 (Explanation)</label>
                                <textarea id="new-card-e" placeholder="補充說明..." rows="3"></textarea>
                            </div>
                            <button class="btn-primary" onclick="saveNewCard()"
                                style="width: 100%; margin-top: 10px;">儲存卡片</button>
                            <button class="btn-secondary" onclick="closeAddCardModal()"
                                style="width: 100%; margin-top: 10px; background: #cbd5e1; border: none; padding: 14px; border-radius: 12px; font-weight: 600; cursor: pointer;">取消</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: ANATOMY (Phase 2) -->
            <section id="view-anatomy" class="view">
                <div class="header-row">
                    <h2>互動解剖室</h2>
                </div>

                <div class="species-tabs">
                    <button class="species-tab active" onclick="switchSpecies('dog')">
                        <ion-icon name="paw"></ion-icon> 狗
                    </button>
                    <button class="species-tab" onclick="switchSpecies('cat')">
                        <ion-icon name="logo-octocat"></ion-icon> 貓
                    </button>
                    <button class="species-tab" onclick="switchSpecies('bird')">
                        <ion-icon name="paper-plane"></ion-icon> 鳥
                    </button>
                    <button class="species-tab" onclick="switchSpecies('horse')">
                        <ion-icon name="trophy"></ion-icon> 馬
                    </button>
                    <button class="species-tab" onclick="switchSpecies('fish')">
                        <ion-icon name="water"></ion-icon> 魚
                    </button>
                </div>

                <div class="anatomy-container" id="anatomy-visual">
                    <!-- Dog Anatomy Image -->
                    <img src="dog.png" id="silhouette-dog" class="animal-img" alt="Dog Anatomy">

                    <!-- Cat Anatomy Image -->
                    <img src="cat.png" id="silhouette-cat" class="animal-img hidden" alt="Cat Anatomy">

                    <img src="bird.png" id="silhouette-bird" class="animal-img hidden" alt="Bird Anatomy">
                    <img src="horse.png" id="silhouette-horse" class="animal-img hidden" alt="Horse Anatomy">
                    <img src="fish.png" id="silhouette-fish" class="animal-img hidden" alt="Fish Anatomy">

                    <div id="hotspots-layer"></div>
                </div>

                <!-- Info Modal / Sheet -->
                <div id="anatomy-modal" class="modal hidden">
                    <div class="modal-content">
                        <span class="close-modal" onclick="closeAnatomyModal()">&times;</span>
                        <div class="modal-header">
                            <span class="term-tag" id="anatomy-category">系統</span>
                            <h3 id="anatomy-title">構造名稱</h3>
                        </div>
                        <p id="anatomy-desc">說明文字...</p>
                    </div>
                </div>
            </section>
            <!-- View: Detective (Clinical Cases) -->
            <section id="view-detective" class="view">
                <div class="welcome-banner">
                    <h2>臨床小偵探</h2>
                    <p>你是值班獸醫，請做出正確判斷！</p>
                </div>

                <div class="detective-container">
                    <!-- Case Card -->
                    <div class="case-card" id="case-card">
                        <div class="case-header">
                            <div class="case-icon" id="case-icon">🐶</div>
                            <div class="case-info">
                                <h3 id="case-patient">病患資料載入中...</h3>
                                <span class="case-id">Case #001</span>
                            </div>
                        </div>
                        <div class="case-body">
                            <h4>主訴症狀：</h4>
                            <p id="case-symptom">...</p>
                            <button id="case-audio-btn" class="audio-btn hidden" onclick="playAudio(event, 'case')">
                                <ion-icon name="volume-high"></ion-icon> 聽診錄音
                            </button>
                        </div>
                        <div class="case-actions" id="case-options">
                            <!-- Buttons will be injected here -->
                        </div>
                        <div class="case-feedback hidden" id="case-feedback">
                            <!-- Result -->
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 20px;">
                        <button class="btn btn-next" onclick="loadNextCase()">下一位病患 <ion-icon
                                name="arrow-forward"></ion-icon></button>
                    </div>
                </div>
            </section>

            <!-- View: Profile -->
            <section id="view-profile" class="view">
                <div class="welcome-banner">
                    <h2>我的檔案</h2>
                    <p>查看您的學習歷程與成就</p>
                </div>

                <div class="profile-header-card">
                    <div class="profile-avatar">
                        <ion-icon name="person"></ion-icon>
                    </div>
                    <div class="profile-info">
                        <h3>王可恩</h3>
                        <span class="level-badge" id="profile-role">Lv. 1 見習生</span>
                        <div class="xp-bar-container">
                            <div class="xp-bar" style="width: 0%;"></div>
                        </div>
                        <span class="xp-text">EXP: 0 / 100</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon color-blue">
                            <ion-icon name="albums"></ion-icon>
                        </div>
                        <div class="stat-value" id="stat-flashcards">0</div>
                        <div class="stat-label">已學卡片</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon color-green">
                            <ion-icon name="medkit"></ion-icon>
                        </div>
                        <div class="stat-value" id="stat-cases">0</div>
                        <div class="stat-label">完成診斷</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon color-orange">
                            <ion-icon name="school"></ion-icon>
                        </div>
                        <div class="stat-value">100%</div>
                        <div class="stat-label">解剖進度</div>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>系統設定</h3>
                    <button class="setting-btn warning" onclick="resetData()">
                        <div class="setting-icon">
                            <ion-icon name="trash-outline"></ion-icon>
                        </div>
                        <div class="setting-text">
                            <h4>重置學習紀錄</h4>
                            <p>清除所有自訂卡片與學習進度</p>
                        </div>
                        <ion-icon name="chevron-forward-outline"></ion-icon>
                    </button>

                    <div class="app-version">
                        <p>VetLite v1.2.0 (Midnight Edition)</p>
                        <p>© 2025 Deepmind Veterinary GenAI Team</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchTab('dashboard')" id="nav-dashboard">
                <ion-icon name="home-outline"></ion-icon>
                <span>首頁</span>
            </button>
            <button class="nav-item" onclick="switchTab('flashcards')" id="nav-flashcards">
                <ion-icon name="albums-outline"></ion-icon>
                <span>卡片</span>
            </button>
            <button class="nav-item" onclick="switchTab('anatomy')" id="nav-anatomy">
                <ion-icon name="body-outline"></ion-icon>
                <span>解剖室</span>
            </button>
            <button class="nav-item" onclick="switchTab('detective')" id="nav-detective">
                <ion-icon name="medkit-outline"></ion-icon>
                <span>診間</span>
            </button>
            <button class="nav-item" onclick="switchTab('profile')" id="nav-profile">
                <ion-icon name="person-outline"></ion-icon>
                <span>我的</span>
            </button>
        </nav>
    </div>

    <!-- Level Up Overlay -->
    <div id="level-up-overlay" class="level-up-overlay hidden" onclick="closeLevelUp()">
        <div class="confetti-container"></div>
        <div class="level-up-content">
            <h1>LEVEL UP!</h1>
            <div class="new-badge">
                <ion-icon name="medal"></ion-icon>
                <span id="new-level-title">Lv. 2 實習醫生</span>
            </div>
            <p>恭喜晉升！繼續保持！</p>
            <button class="btn-close-overlay" onclick="closeLevelUp()">點擊繼續 (Tap to Close)</button>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="app.js"></script>
</body>

</html>